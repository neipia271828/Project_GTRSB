GTRラップタイム記録ブラウザアプリ - システム構成（厳密版）
1. システム方針の再確認
本アプリケーションは、神山まるごと高専生に特化したGTRラップタイム記録ツールとして、以下の開発方針を最優先とします。

シンプルさと手軽さ: 複雑な機能や仕組みは徹底的に排除し、コアな「記録と比較」に集中します。
限定されたコミュニティ: アクセスを神山まるごと高専生のみに厳しく限定します。
効率的な開発と運用: 維持管理の容易さを重視し、複雑なインフラや技術は採用しません。
2. システム構成概要
アプリケーションは、ウェブブラウザを介してアクセスされるクライアントサイドと、データ管理および認証ロジックを担うサーバーサイドで構成されます。データ永続化には軽量なデータベースを使用します。

+----------------+       +----------------+       +-------------------+
|                |       |                |       |                   |
|  ユーザーブラウザ  | <-----> |   Webサーバー    | <-----> |   データベース (SQLite)   |
|                |       |                |       |                   |
+----------------+       +----------------+       +-------------------+
        ▲                        ▲
        |                        |
        |  HTTP(S) リクエスト/レスポンス  |
        ▼                        ▼
+-------------------------------------------------+
|                                                 |
|          認証ロジック / アプリケーションロジック          |
|          (例: Python/Flask, Node.js/Express)          |
|                                                 |
+-------------------------------------------------+
3. 各コンポーネントの詳細定義
3.1. クライアントサイド (ユーザーブラウザ)
技術スタック:
HTML: アプリケーションの骨格構造を定義。
CSS: スタイリングとレイアウト（レスポンシブデザインを含む）。
JavaScript: 動的なUI操作、サーバーとのAPI通信、入力値の簡易バリデーション。
ライブラリ: Vue.js, React などのフレームワークは導入せず、Vanilla JavaScript を主軸とし、必要に応じて軽量なDOM操作ライブラリ (例: Alpine.js) の導入を検討します。これにより、バンドルサイズを抑え、開発の複雑性を低減します。
初期画面:
アプリにアクセスすると、全面が真っ黒な背景となり、画面中央にログイン/登録フォームのみが表示されます。
登録が完了するまで、ラップタイム閲覧や記録などの他の機能へのアクセスは一切不可とします。
フォームバリデーション: クライアントサイドでの簡易的な入力値チェック（例: ラップタイムのフォーマット、パスワード桁数など）。
3.2. サーバーサイド (Webサーバー & アプリケーションロジック)
技術スタック:
言語: Python (Flask) または Node.js (Express) を推奨。いずれも軽量で迅速な開発に適しています。
フレームワーク: 各言語のミニマリストなフレームワークを採用し、ルーティング、リクエスト処理、データベース連携などを実装します。
主な責務:
HTTPリクエストの受付と処理: クライアントからのリクエストをルーティングし、適切なロジックを実行します。
認証・認可: ユーザー登録、ログイン、および各操作に対するアクセス制御を行います。
データベース操作: ラップタイムデータの永続化、取得、更新。
APIエンドポイントの提供: クライアントサイドからのデータ送受信のためのRESTful APIを定義します。
セキュリティ対策: CSRF（クロスサイトリクエストフォージェリ）対策、入力値のサニタイジングなど、最低限のウェブセキュリティ対策を講じます。
3.3. データベース
技術スタック:
SQLite: 本アプリケーションの要件（小規模、手軽な運用、ファイルベース）に最も適しています。単一ファイルでデータベースを管理でき、別途データベースサーバーの構築が不要なため、運用の手間が大幅に削減されます。
主なテーブル:
users テーブル:
id (主キー): ユーザーID
username (ユニーク): ユーザー名（ニックネーム）
kamiyama_id_hash (ユニーク): 神山まるごと高専生識別用のメールアドレスのハッシュ値、またはクイズ認証の識別子。
password_hash: 四桁パスワードのハッシュ値。
created_at: 登録日時
laps テーブル:
id (主キー): ラップタイムID
user_id (外部キー): 登録ユーザーのID
game_title: ゲームタイトル (文字列)
car_model: 車種 (文字列)
track_name: コース名 (文字列)
lap_time: ラップタイム (例: 浮動小数点数で秒数を格納、表示時にフォーマット)
recorded_at: 記録日時
notes: 備考 (文字列、NULL許容)
4. 認証・アクセス制御フローの詳細
4.1. 新規ユーザー登録フロー
ユーザーがアプリにアクセスすると、黒い画面に登録フォームのみが表示されます。
フォームには以下の入力欄があります。
メールアドレス: kmcXXXX@kamiyama.ac.jp 形式のメールアドレスを入力。
四桁パスワード: 任意の4桁の数字パスワードを入力。
ユーザー名: アプリ内で表示されるニックネームを入力。
ユーザーが登録ボタンをクリックすると、サーバーサイドにデータが送信されます。
サーバーサイドでの認証ロジック:
メールアドレス形式チェック: 入力されたメールアドレスがkmcXXXX@kamiyama.ac.jpの形式に厳密に一致するか検証します。
形式が一致しない場合: 登録を拒否し、エラーメッセージをクライアントに返します。
四桁パスワードのハッシュ化: 入力された四桁パスワードを強力なハッシュアルゴリズム（例: bcrypt, PBKDF2）でハッシュ化します。
ユーザー情報の保存: メールアドレスの形式が正しく、かつそのメールアドレスまたは四桁パスワードが既存ユーザーと重複しないことを確認した後、usersテーブルにユーザー名、ハッシュ化された神山まるごと高専生識別情報（メールアドレスのハッシュ値など）、ハッシュ化されたパスワードを保存します。
成功時の応答: 登録成功後、セッション情報（ユーザーIDなど）を生成し、クライアントに返します。
登録が成功すると、ユーザーはアプリのメイン機能（ラップタイム記録・閲覧）へアクセス可能になります。
4.2. 既存ユーザーログインフロー
ユーザーがアプリにアクセスすると、黒い画面にログインフォームのみが表示されます。
フォームには以下の入力欄があります。
登録メールアドレス: 登録時に使用したメールアドレスを入力。
四桁パスワード: 登録時に設定した4桁のパスワードを入力。
ユーザーがログインボタンをクリックすると、サーバーサイドにデータが送信されます。
サーバーサイドでの認証ロジック:
入力されたメールアドレスに対応するユーザーをデータベースから検索します。
ユーザーが見つかった場合、入力された四桁パスワードをハッシュ化し、データベースに保存されているハッシュ値と比較します。
両方が一致した場合、ログイン成功とみなし、セッション情報をクライアントに返します。
一致しない場合: ログイン失敗のエラーメッセージをクライアントに返します。
ログインが成功すると、ユーザーはアプリのメイン機能へアクセス可能になります。
5. 運用と拡張性
デプロイ: 開発の容易さを考慮し、シンプルなVPS（Virtual Private Server）またはPaaS（Platform as a Service, 例: Heroku, Render の無料枠など）へのデプロイを検討します。
今後の機能拡張:
神山まるごと高専生の卒業などによるアカウント管理の仕組み（手動運用も可）。
ユーザーが登録したコースや車種のリスト化と選択機能（手入力との併用）。
このシステム構成は、「複雑な仕組みは使わずより簡単な方法を探し続ける」という方針を維持しつつ、認証の厳密性を高め、神山まるごと高専生という特定のコミュニティに限定する機能を明確に定義しました。SQLiteの使用は、開発と運用の簡素化に大きく貢献します。 